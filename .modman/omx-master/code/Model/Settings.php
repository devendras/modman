<?php
 class Omx_Hooks_Model_Settings extends Mage_Core_Model_Abstract { const OMX_VERSION = 'omxVersion'; const ORDER_RESUBMISSION_TIME = 'lastResubmissionJobTime'; const ORDER_RESUBMISSION_COUNT = 'resubmissionJobRunCount'; const PRODUCT_RESUBMISSION_TIME = 'lastProductSendingJobTime'; const PRODUCT_RESUBMISSION_COUNT = 'productSendingJobRunCount'; const PRODUCT_FORCE_SENDING = 'forceProductSending'; protected function _construct () { $this->_init('hooks/settings'); } public function isEditable () { if( $this->name !== self::OMX_VERSION && $this->name !== self::ORDER_RESUBMISSION_TIME && $this->name !== self::ORDER_RESUBMISSION_COUNT && $this->name !== self::PRODUCT_RESUBMISSION_TIME && $this->name !== self::PRODUCT_RESUBMISSION_COUNT && $this->name !== self::PRODUCT_FORCE_SENDING ){ return true; } return false; } public function isVisible () { if( $this->name !== self::OMX_VERSION && $this->name !== self::PRODUCT_FORCE_SENDING ){ return true; } return false; } public function save() { if($this->name == 'useOmxTaxCalculation' && $this->value == 0) { $useMP = Mage::getModel('hooks/settings') ->getCollection() ->addFilter('name', 'useOmxMarketingPolicies') ->load() ->getFirstItem(); if ($useMP instanceof Omx_Hooks_Model_Settings) { $useMP->value = 0; $useMP->save(); } } if($this->name == 'useOmxMarketingPolicies') { $useTax = Mage::getModel('hooks/settings') ->getCollection() ->addFilter('name', 'useOmxTaxCalculation') ->load() ->getFirstItem(); if($useTax instanceof Omx_Hooks_Model_Settings && $useTax->value == 0) { $this->value = 0; } } parent::save(); } }
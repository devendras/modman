<?php
 abstract class Omx_Hooks_Model_Xml_Abstract { protected $xml; const VERSION = '1.0'; const ENCODING = 'UTF-8'; public function __construct () { $this->xml = new DOMDocument( self::VERSION, self::ENCODING); $this->xml->formatOutput = true; } public function getXmlString () { return $this->xml->saveXML(); } public function getXmlObject () { return $this->xml; } public function getEncodedXmlString () { return Mage::helper('core')->encrypt($this->getXmlString()); } abstract protected function createRootElement (); protected function log ($data) { $omx_now = Zend_Date::now(); $omx_now->setTimezone('America/New_York'); $data['timestamp'] = $omx_now->toString("yyyy-MM-dd HH:mm:ss"); $log = Mage::getModel('hooks/logs')->setData( $data); try { $log->save(); unset($data); return $log->getId(); } catch (Exception $e) { Mage::getSingleton('adminhtml/session')->addError($e->getMessage()); return false; } } protected function createSafeElement($name, $value = null) { if (!is_null($value)) { return $this->xml->createElement($name, $this->_xmlspecialchars($value)); } else { return $this->xml->createElement($name); } } private function _xmlspecialchars($text) { return str_replace('&#039;', '&apos;', htmlspecialchars($text, ENT_QUOTES)); } } 
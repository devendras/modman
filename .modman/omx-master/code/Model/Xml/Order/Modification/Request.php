<?php
 class Omx_Hooks_Model_Xml_Order_Modification_Request extends Omx_Hooks_Model_Xml_Abstract { protected $_order; protected $_root; protected $_lines = array(); public function __construct () { $args = func_get_args(); parent::__construct(); $this->createRootElement(); if ($args[0][0] instanceof Omx_Hooks_Model_Order){ $this->_order = $args[0][0]; } if(is_array($args[0][1])) { $this->_lines = $args[0][1]; } $this->appendOrder(); } protected function createRootElement () { $rootElement = $this->createSafeElement('OrderDetailUpdateRequest'); $rootVersionElement = $this->xml->createAttribute('version'); $rootElement->appendChild( $rootVersionElement ); $rootVersionValue = $this->xml->createTextNode('1.00'); $rootVersionElement->appendChild($rootVersionValue); $this->xml->appendChild($rootElement); $this->_root = $rootElement; } protected function appendOrder () { $orderElement = $this->_root->appendChild($this->createSafeElement('Order')); $orderNumberAttrText = $this->xml->createTextNode($this->_order->orderNumber); $orderNumberAttr = $this->xml->createAttribute('orderNumber'); $orderNumberAttr->appendChild($orderNumberAttrText); $orderElement->appendChild($orderNumberAttr); $orderDetailElement = $orderElement->appendChild($this->createSafeElement('OrderDetail')); foreach ($this->_lines as $lineNumber => $line) { $lineElement = $orderDetailElement->appendChild($this->createSafeElement('LineItem')); $lineNumberAttrText = $this->xml->createTextNode($lineNumber); $lineNumberAttr = $this->xml->createAttribute('lineNumber'); $lineNumberAttr->appendChild($lineNumberAttrText); $lineElement->appendChild($lineNumberAttr); if (array_key_exists('quantity', $line)) $lineElement->appendChild($this->createSafeElement('Quantity', $line['quantity'])); if (array_key_exists('standingOrder', $line)) { $standingOrder = $lineElement->appendChild($this->createSafeElement('StandingOrder')); $nameAttrText = $this->xml->createTextNode($line['standingOrder']); $nameAttr = $this->xml->createAttribute('configurationName'); $nameAttr->appendChild($nameAttrText); $standingOrder->appendChild($nameAttr); } } } }
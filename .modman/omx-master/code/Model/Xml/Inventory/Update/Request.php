<?php
 class Omx_Hooks_Model_Xml_Inventory_Update_Request extends Omx_Hooks_Model_Xml_Abstract { protected $_product; protected $_root; public function __construct (Mage_Catalog_Model_Product $product) { parent::__construct(); $this->_product = $product; $this->createRootElement(); $this->appendItems(); } protected function createRootElement () { $rootElement = $this->createSafeElement('InventoryUpdateRequest'); $versionAttribute = $this->xml->createAttribute('version'); $rootElement->appendChild( $versionAttribute ); $rootAttributeValue = $this->xml->createTextNode('3.00'); $versionAttribute->appendChild($rootAttributeValue); $rootElement = $this->xml->appendChild($rootElement); $this->_root = $rootElement; } protected function appendUdiParams () { $UDIParameter = $this->_root->appendChild( $this->createSafeElement('UDIParameter') ); $autoAssignLocation = $this->createSafeElement('Parameter', 'True'); $autoAssignLocationText = $this->xml->createTextNode('AutoAssignLocation'); $autoAssignLocationFlag= $this->xml->createAttribute('key'); $autoAssignLocationFlag->appendChild($autoAssignLocationText); $autoAssignLocation->appendChild($autoAssignLocationFlag); $UDIParameter->appendChild($autoAssignLocation); } protected function appendItems () { $items = $this->_root->appendChild( $this->createSafeElement('Items') ); $item = $items->appendChild( $this->createSafeElement('Item') ); $itemAttribute = $this->xml->createAttribute('itemCode'); $itemAttributeValue = $this->xml->createTextNode($this->_product->getSku()); $itemAttribute->appendChild($itemAttributeValue); $item->appendChild($itemAttribute); if ($this->_product->getStockItem()->getManageStock()) { $quantity = intval($this->_product->getStockItem()->getQty()); $onHand = $this->createSafeElement('OnHand', $quantity); $item->appendChild($onHand); } } }
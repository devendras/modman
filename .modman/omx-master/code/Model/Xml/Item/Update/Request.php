<?php
 class Omx_Hooks_Model_Xml_Item_Update_Request extends Omx_Hooks_Model_Xml_Abstract { protected $_product; protected $_root; public function __construct (Mage_Catalog_Model_Product $product) { parent::__construct(); $this->_product = $product; $this->createRootElement(); $this->appendItem(); } protected function createRootElement () { $rootElement = $this->createSafeElement('ItemUpdateRequest'); $versionAttribute = $this->xml->createAttribute('version'); $rootElement->appendChild( $versionAttribute ); $rootAttributeValue = $this->xml->createTextNode('2.00'); $versionAttribute->appendChild($rootAttributeValue); $rootElement = $this->xml->appendChild($rootElement); $this->_root = $rootElement; } protected function appendItem () { $items = $this->_root->appendChild( $this->createSafeElement('Items') ); $item = $items->appendChild( $this->createSafeElement('Item') ); $item->appendChild( $this->createSafeElement('ItemCode', $this->_product->getSku()) ); $item->appendChild( $this->createSafeElement('ProductStatus', $this->_product->getStatus() == 1 ? 1 : 0) ); $item->appendChild( $this->createSafeElement('ProductName', $this->_product->getName()) ); $item->appendChild( $this->createSafeElement('Weight', $this->_product->getWeight()) ); $item->appendChild( $this->createSafeElement('InfoText', $this->_product->getShortDescription()) ); $item->appendChild( $this->createSafeElement('InfoTextHTML', $this->_product->getDescription()) ); if ($this->_product->isConfigurable()) { $configAttr = $this->_product->getTypeInstance(true)->getConfigurableAttributesAsArray($this->_product); if (count($configAttr) > 3) throw new Exception('The product has more than three configurable attributes. OMX only supports a maximum of three.'); if (array_key_exists(0, $configAttr)) $item->appendChild( $this->createSafeElement('DimensionX', $configAttr[0]['label']) ); if (array_key_exists(1, $configAttr)) $item->appendChild( $this->createSafeElement('DimensionY', $configAttr[1]['label']) ); if (array_key_exists(2, $configAttr)) $item->appendChild( $this->createSafeElement('DimensionZ', $configAttr[2]['label']) ); } } } 
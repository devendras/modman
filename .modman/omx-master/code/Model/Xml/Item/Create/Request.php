<?php
 class Omx_Hooks_Model_Xml_Item_Create_Request extends Omx_Hooks_Model_Xml_Abstract { protected $_product; protected $_root; public function __construct (Mage_Catalog_Model_Product $product) { parent::__construct(); $this->_product = $product; $this->createRootElement(); $this->appendItem(); } protected function createRootElement () { $rootElement = $this->createSafeElement('ItemUpdateRequest'); $versionAttribute = $this->xml->createAttribute('version'); $rootElement->appendChild( $versionAttribute ); $rootAttributeValue = $this->xml->createTextNode('2.00'); $versionAttribute->appendChild($rootAttributeValue); $rootElement = $this->xml->appendChild($rootElement); $this->_root = $rootElement; } protected function appendItem () { $items = $this->_root->appendChild( $this->createSafeElement('Items') ); $item = $items->appendChild( $this->createSafeElement('Item') ); $item->appendChild( $this->createSafeElement('ItemCode', $this->_product->getSku()) ); $item->appendChild( $this->createSafeElement('ProductStatus', $this->_product->getStatus() == 1 ? 1 : 0) ); $item->appendChild( $this->createSafeElement('ProductName', $this->_product->getName()) ); $item->appendChild( $this->createSafeElement('IncompleteFlag', 1) ); $item->appendChild( $this->createSafeElement('Weight', $this->_product->getWeight()) ); $item->appendChild( $this->createSafeElement('InfoText', $this->_product->getShortDescription()) ); $item->appendChild( $this->createSafeElement('InfoTextHTML', $this->_product->getDescription()) ); $item->appendChild( $this->createSafeElement('CostOfGoods', $this->_product->getCost()) ); $now = Zend_Date::now(); $now->setTimezone('America/New_York'); $stringDate = $now->toString('yyyy-MM-dd'); $inventoryType = 0; if ($this->_product->getStockItem()->getManageStock()) $inventoryType = 1; $item->appendChild( $this->createSafeElement('InventoryType', $inventoryType) ); $item->appendChild( $this->createSafeElement('FileSubCode', 0) ); $item->appendChild( $this->createSafeElement('ProductGroup', 1) ); $item->appendChild( $this->createSafeElement('LaunchDate', $stringDate) ); if ($this->_product->isConfigurable()) { $configAttrArr = $this->_product->getTypeInstance()->getConfigurableAttributesAsArray(); if (count($configAttrArr) > 3) throw new Exception('The product has more than three configurable attributes. OMX only supports a maximum of three.'); if (array_key_exists(0, $configAttrArr)) $item->appendChild( $this->createSafeElement('DimensionX', $configAttrArr[0]['label']) ); if (array_key_exists(1, $configAttrArr)) $item->appendChild( $this->createSafeElement('DimensionY', $configAttrArr[1]['label']) ); if (array_key_exists(2, $configAttrArr)) $item->appendChild( $this->createSafeElement('DimensionZ', $configAttrArr[2]['label']) ); } } } 
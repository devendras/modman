<?php
 class Omx_Hooks_Model_Omxpricing_Checkout_Type_Onepage extends Mage_Checkout_Model_Type_Onepage { public function __construct() { parent::__construct(); } public function initCheckout() { parent::initCheckout(); } public function saveOmxdiscount($data) { try { $quote = $this->getQuote(); $freeItems = Mage::helper('hooks/omxpricing')->getDiscounts($quote, Omx_Hooks_Model_Omxpricing_Calculator::OMX_FREE_ITEM_DISCOUNTS); Mage::helper('hooks/omxpricing')->addSelectedItemsToQuote($data, $quote); $quote->save(); $this->getCheckout() ->setStepData('omxdicount', 'complete', true) ->setStepData('payment', 'allow', true); return array(); } catch (Exception $e) { Mage::helper('hooks/data')->log( $request = '', $response='', $comment = 'OMXPRICING ONEPAGECHEKOUT:'.$e->getMessage() ); return array( 'error' => true, 'message' => Mage::helper('hooks/data')->__('Error saving data.'), ); } } }
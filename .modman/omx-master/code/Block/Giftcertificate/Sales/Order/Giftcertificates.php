<?php
 class Omx_Hooks_Block_Giftcertificate_Sales_Order_Giftcertificates extends Mage_Core_Block_Template { public function initTotals() { $total = new Varien_Object(array( 'code' => $this->getNameInLayout(), 'block_name'=> $this->getNameInLayout(), 'area' => $this->getArea() )); $this->getParentBlock()->addTotalBefore($total, array('customerbalance', 'grand_total')); return $this; } public function getUsedCertificate() { $result = array(); $source = $this->getSource(); if ($source instanceof Mage_Sales_Model_Order) { $certificates = Mage::helper('hooks/giftcertificate')->getCertificates($source); if (count($certificates)) { $result['code'] = $certificates[0]['code']; $result['baseAmountUsed'] = $source->getBaseOmxGiftCertificatesAmountUsed(); $result['amountUsed'] = $source->getOmxGiftCertificatesAmountUsed(); } } return $result; } public function getSource() { return $this->getParentBlock()->getSource(); } }
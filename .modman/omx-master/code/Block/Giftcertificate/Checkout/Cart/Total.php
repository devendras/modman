<?php
 class Omx_Hooks_Block_Giftcertificate_Checkout_Cart_Total extends Mage_Checkout_Block_Total_Default { protected $_template = 'hooks/giftcertificate/checkout/cart/total.phtml'; const REDIRECT_PAYPAL_EXPRESS_REVIEW = 'paypal_express'; const REDIRECT_CART = 'cart'; protected function _construct() { parent::_construct(); } protected function _getQuote() { return Mage::getSingleton('checkout/session')->getQuote(); } public function getQuoteGiftCertificates() { return Mage::helper('hooks/giftcertificate')->getCertificates($this->_getQuote()); } public function getRedirectLocation() { $request = $this->getRequest(); if (mb_strtolower($request->getControllerModule() ) == 'mage_paypal' && mb_strtolower($request->getControllerName() ) == 'express' && mb_strtolower($request->getActionName() ) == 'review' ) { return self::REDIRECT_PAYPAL_EXPRESS_REVIEW; } return self::REDIRECT_CART; } }
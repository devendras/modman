<?php
 class Omx_Hooks_Block_Catalog_Product_Edit_Tab_Omx_PaymentPlans extends Mage_Adminhtml_Block_Widget_Grid { public function __construct() { parent::__construct(); $this->setId('omx_product_paymentplans'); $this->setFilterVisibility(false); $this->setPagerVisibility(false); $this->setUseAjax(true); } protected function _getProduct() { return Mage::registry('current_product'); } protected function _prepareCollection() { $product = $this->_getProduct(); $products = Mage::getModel('catalog/product')->getCollection() ->addAttributeToSelect("omx_payment_plan_infos"); $wantedProduct = $products->getItemById($this->_getProduct()->getId()); $infos = unserialize($wantedProduct->getOmxPaymentPlanInfos()); $collection = new Varien_Data_Collection(); if (is_array($infos)) { foreach ($infos as $info) { $item = new Varien_Object(); $item->addData(array('plan_id' => $info->planID, 'name' => $info->name)); $collection->addItem($item); } } $this->setCollection($collection); return parent::_prepareCollection(); } protected function _prepareColumns() { $this->addColumn('plan_id', array( 'header' => Mage::helper('hooks')->__('ID'), 'width' => 60, 'index' => 'plan_id', 'sortable' => false, 'filter' => false )); $this->addColumn('name', array( 'header' => Mage::helper('hooks')->__('OMX Item Payment Plans'), 'index' => 'name', 'sortable' => false, 'filter' => false )); return parent::_prepareColumns(); } } 
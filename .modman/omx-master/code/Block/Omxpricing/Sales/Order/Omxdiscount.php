<?php  class Omx_Hooks_Block_Omxpricing_Sales_Order_Omxdiscount extends Mage_Core_Block_Template { public function initTotals() { $total = new Varien_Object(array( 'code' => $this->getNameInLayout(), 'block_name'=> $this->getNameInLayout(), 'area' => $this->getArea() )); $this->getParentBlock()->addTotal($total, 'omxdiscount'); return $this; } public function getSource() { return $this->getParentBlock()->getSource(); } public function getDiscountLines() { $amountDiscountsData = array(); $order = $this->getParentBlock()->getSource(); if($order instanceof Mage_Sales_Model_Order) { $amountDiscountsData = Mage::helper('hooks/omxpricing')->getDiscounts( $order, Omx_Hooks_Model_Omxpricing_Calculator::OMX_AMOUNT_DISCOUNTS ); if(!array_key_exists('discountPolicies', $amountDiscountsData)) { return array(); } if(!is_array($amountDiscountsData['discountPolicies'])) { return array(); } return $amountDiscountsData['discountPolicies']; } return array(); } }
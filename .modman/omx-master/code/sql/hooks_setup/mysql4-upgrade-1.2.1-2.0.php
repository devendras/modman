<?php
$createUseOmxTaxCalculation = (Mage::helper('hooks/data')->getSettings('useOmxTaxCalculation')===false) ? true : false; $createOmxTaxMagentoFallbackMessage = (Mage::helper('hooks/data')->getSettings('omxTaxMagentoFallbackMessage')===false) ? true : false; $createOmxTaxOmxFallbackMessage = (Mage::helper('hooks/data')->getSettings('omxTaxOmxFallbackMessage')===false) ? true : false; $createUseOmxMarketingPolicies = (Mage::helper('hooks/data')->getSettings('useOmxMarketingPolicies')===false) ? true : false; $queryString = ''; $queryString = "UPDATE {$this->getTable('omx__settings')} SET `value` = '2.0' WHERE {$this->getTable('omx__settings')}.`name`='omxVersion' LIMIT 1 ; "; if ($createUseOmxTaxCalculation) { $queryString .= "INSERT INTO {$this->getTable('omx__settings')} (`id`, `name`, `value`) VALUES (NULL, 'useOmxTaxCalculation', '0'); "; } if ($createOmxTaxMagentoFallbackMessage) { $queryString .= "INSERT INTO {$this->getTable('omx__settings')} (`id`, `name`, `value`) VALUES (NULL, 'omxTaxMagentoFallbackMessage', ''); "; } if ($createOmxTaxOmxFallbackMessage) { $queryString .= "INSERT INTO {$this->getTable('omx__settings')} (`id`, `name`, `value`) VALUES (NULL, 'omxTaxOmxFallbackMessage', ''); "; } if($createUseOmxMarketingPolicies) { $queryString.= "INSERT INTO {$this->getTable('omx__settings')} (`id`, `name`, `value`) VALUES (NULL, 'useOmxMarketingPolicies', '0'); "; } $installer = $this; $installer->startSetup(); $installer->run($queryString); $installer->installEntities( array ( 'order' => array( 'entity_model' => 'order', 'table' => 'sales/order', 'increment_model'=>'eav/entity_increment_numeric', 'increment_per_store'=>true, 'backend_prefix'=>'sales_entity/order_attribute_backend', 'attributes' => array( 'omx_tax_used' => array( 'label' => 'Omx Tax Calculation Used', 'type' => 'int', 'is_null' => true, 'default' => NULL, 'global' => Mage_Catalog_Model_Resource_Eav_Attribute::SCOPE_GLOBAL, 'visible' => true, 'required' => false, 'user_defined' => true, ), 'omx_pricing' => array( 'label' => 'Omx Pricing Data', 'type' => 'text', 'global' => Mage_Catalog_Model_Resource_Eav_Attribute::SCOPE_GLOBAL, 'visible' => true, 'required' => false, 'user_defined' => true, ), ), ), 'quote' => array( 'entity_model' => 'quote', 'table' => 'sales/quote', 'attributes' => array( 'omx_tax_used'=>array('type' => 'int'), 'omx_pricing' => array('type' => 'text'), 'omx_order_keycode' => array('type' => 'varchar'), 'omx_trigger_price_calc' =>array('type'=>'int'), ), ), ) ); $installer->addAttribute('invoice', 'omx_tax_used', array('type'=>'int')); $installer->addAttribute('invoice', 'omx_pricing', array('type'=>'text')); $installer->endSetup(); 